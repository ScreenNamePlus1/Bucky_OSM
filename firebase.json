{
  "rules_version": "2",
  "service": "cloud.firestore",
  "match": "/databases/{database}/documents",
  "rules": {
    "match": "/users/{userId}",
    "rules": {
      "allow": {
        "read": "request.auth.uid == userId",
        "write": "request.auth.uid == userId"
      }
    },
    "match": "/requests/{requestId}",
    "rules": {
      "allow": {
        "read": "request.auth.uid == resource.data.customerId || resource.data.driverId == request.auth.uid",
        "write": "request.auth.uid == resource.data.customerId || resource.data.driverId == request.auth.uid"
      }
    },
    "match": "/bids/{bidId}",
    "rules": {
      "allow": {
        "read": "request.auth.uid == resource.data.driverId || (exists(/databases/$(database)/documents/requests/$(resource.data.requestId)) && get(/databases/$(database)/documents/requests/$(resource.data.requestId)).data.customerId == request.auth.uid)",
        "write": "request.auth.uid == resource.data.driverId"
      }
    }
  }
}